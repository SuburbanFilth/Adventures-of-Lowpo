os: linux
dist: bionic
jobs:
  include:
    - stage: Build and Test
      name: "Unit Tests"
      script: make && make test && export DISPLAY=:0 && ./out/test
      name: Code Coverage
      script: 
        - make gcov && ./out/gcov_exe
        - chmod +x ./scripts/get_code_coverage_reports.sh
        - cd ./out
        - ../scripts/get_code_coverage_reports.sh
        - cd ../
        - codecov
      name: Documentation Generation
      script: chmod +x ./scripts/run_doxygen.sh && mkdir docs && ./scripts/run_doxygen.sh
      deploy:
        provider: pages
        token: $GH_TOKEN
        local_dir: ./docs/html
compiler: gcc-8
addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - gcc-8
language: cpp
notifications: never
before_install: sudo pip install codecov && mkdir out && sudo apt-get install -y libglm-dev libglfw3-dev libglew-dev libxi-dev doxygen